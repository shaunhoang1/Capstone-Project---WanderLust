<!DOCTYPE html>
<html>
  <head>
    <title>WanderLust VR Story</title>
    <!-- Load styles -->
    <link href="main.css" rel="stylesheet" />

    <!-- Load A-Frame -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>

    <!-- Load JS Events -->
    <script>
      //Navigate between paragraphs
      document.addEventListener("keydown", function (event) {
        //Go to previous paragraph
        if (event.key === "q") {
          changePage(-1);

          //Go to next paragraph
        } else if (event.key === "e") {
          changePage(1);
        }
      });

      //Toggle Background
      var currentSky = 0;
      document.addEventListener("keydown", function (event) {
        //Go to previous paragraph
        if (event.shiftKey) {
          changeSky(1);
        }
      });

      //interactions
      /*
            AFRAME.registerComponent('button-interaction-handler', {
                init: function () {
                    var skyEl = this.el.sceneEl.querySelector('#background');
                    var cubeEl = this.el.sceneEl.querySelector('#left-cube');

                    this.el.addEventListener('mouseenter', function () {
                        skyEl.setAttribute('src', '#pano-brush');  
                        cubeEl.setAttribute('scale', '3 3 3');  
                        document.querySelector('[camera]').setAttribute('wasd-controls-enabled','"false"');
                    });

                    this.el.addEventListener('mouseleave', function () {
                        skyEl.setAttribute('src', '#pano-town');
                        cubeEl.setAttribute('scale', '1 1 1');
                        document.querySelector('[camera]').setAttribute('wasd-controls-enabled','"true"');
                    });
                }  
            });

            AFRAME.registerComponent('text-next-click-handler', {
                init: function () {
                    //var skyEl = this.el.sceneEl.querySelector('#thing');
                    this.el.addEventListener('click', function () {
                        var textObj = document.getElementById("textPara")
                        textObj.removeAttribute('animation');
                        textObj.removeAttribute('animation__2');
                        textObj.setAttribute('animation__2','property: opacity; from:0;to: 1; dur: 5000; easing: linear; loop: 1; dir:alternate;')
                        textObj.setAttribute('animation','property: position; from:-8 -20 -10;to: -8 10 -10; dur: 10000; easing: linear; loop: false;')
                        
                    });
                    
                }   
            });*/

      AFRAME.registerComponent("button-click-handler", {
        init: function () {
          var skyEl = this.el.sceneEl.querySelector("#thing");

          this.el.addEventListener("click", function () {
            skyEl.setAttribute("scale", "5 5 5");
          });
        },
      });

      //Define theBackgrounds
      var currentSky = 0;
      const skies = [];
      skies[1] = "#skyLawn";
      //skies[2] = "#skyScenes";
      //skies[3] = "#skySnow";
      skies[2] = "#skyVillage";
      //skies[5] = "#skyWhite";
      skies[3] = "#skyWoods";
      function changeSky(skyChange) {
        currentSky += skyChange;
        if (currentSky > skies.length - 1) {
          currentSky = 1;
        }
        if (currentSky < 1) {
          currentSky = skies.length - 1;
        }
        var sky = document.getElementById("sky");
        sky.setAttribute("src", skies[currentSky]);
      }

      //Define the page number and change
      var currentPage = 0;
      function changePage(pageChange) {
        currentPage += pageChange;
        if (currentPage > storyParagraphs.length - 1) {
          currentPage = 1;
        }
        if (currentPage < 1) {
          currentPage = storyParagraphs.length - 1;
        }

        //Select the text object
        var textObj = document.getElementById("textPara");
        textObj.setAttribute("opacity", 0);
        textObj.setAttribute("value", storyParagraphs[currentPage]);

        //Reset and activate the Position animation
        textObj.removeAttribute("animation__pos");
        textObj.setAttribute(
          "animation__pos",
          "property: position; from:0 -10 -20;to: 0 10 -20; dur: 15000; easing: linear; loop: false;"
        );

        //Reset and activate the opacity animation
        textObj.removeAttribute("animation__opa");
        textObj.setAttribute(
          "animation__opa",
          "property: opacity; from:0;to: 1; dur: 7500; easing: linear; Elasticity:400; loop: 1; dir:alternate;"
        );
      }

      //Define Story paragraphs
      const storyParagraphs = [];
      storyParagraphs[0] = "THIS IS THE ZEROTH PARAGRAPH, NO ONE WILL SEE THIS";
      storyParagraphs[1] =
        "1 Fable: Long ago in the Blue Mountains, three Aboriginal sisters; Meenhi, Wimlah and Gunnedoo lived with their father, a Witch doctor named Tyawan. In the same forest lived a gigantic creature that was feared by all â€“ he was the Bunyip. Tyawan who knew where he lived would leave his daughters on the cliff behind a rocky wall where they would be safe while he would collect food.";
      storyParagraphs[2] =
        "2 One day, waving goodbye to his daughters he descended the cliff steps. On the top of the cliff, a big lizard suddenly appeared and frightened Meenhi. She picked up a stone and threw it at the lizard. The stone rolled away over the cliff and crashed into the valley below. Suddenly, the rocks behind the three sisters split open, leaving the sisters on a thin ledge. There was a deep rumble from below and the angry Bunyip emerged from his sleep. He looked up to see who had rudely awakened him and there perched on the thin ledge he saw the sisters cowering in fear. Furiously he lurched towards them.";
      storyParagraphs[3] =
        "3 In the valley, Tyawan heard the cry and looked up to see that the Bunyip had almost reached his daughters. Frantically the Witch Doctor pointed his magic bone at the girls and turned them into stone. They would be safe there until the Bunyip was gone and then Tyawan would return them to their former selves.";
      storyParagraphs[4] =
        "4 The Bunyip was even more angry when he saw what had happened and he turned on Tyawan and began to chase him. Running away, Tyawan found himself trapped against a rock which he could neither climb nor go around. He quickly changed into a Lyrebird and disappeared into a small cave. Everyone was safe but Tyawan had dropped his magic bone. The Bunyip returned angrily to his hole. Tyawan crept out of the cave and searched for the bone, and is still seeking it while the Three Sisters stand silently waiting, hoping he will find the bone and turn them back to their former selves. \n \n You can see the Three Sisters today from Echo Point and in the valley you can hear Tyawan, the Lyrebird, calling them as he searches for his lost magic bone.";
      storyParagraphs[5] =
        "5 Moral: The forests are beautiful, but you must always be careful to know what creatures live there.";
    </script>
  </head>
    
  <body>
      <!-- HTML Elements to create a page before scene
      <!--
    <button type="button" onClick="onClick()">Click me</button>
    <p>Clicks: <a id="clicks">0</a></p>-->
    <a-scene stats id="VRScene">
      <a-assets>
          <!-- CANNOT UPLOAD OBJECTS TO GITHUB -->
        <a-asset-item id="firstModel" src="Resources/Objects/testObj.obj"></a-asset-item>
        <a-asset-item id="venator" src="Resources/Objects/venator/Venator.obj"></a-asset-item>
        <a-asset-item id="plant1" src="Resources/Objects/folder/Vase%20Pack%202.FBX"></a-asset-item>
        <img id="imgBunyip" src="Resources/Images/Bunyip_5.jpg"/>
        <img id="imgBunyip2" src="Resources/Images/bunyip-emerging.jpg"/>
          
        <!-- Skybox Images-->
        <img id="skyLawn" src="Resources/Backgrounds/lawn-Mansion.jpeg" />
        <img id="skyScenes" src="Resources/Backgrounds/scenes.jpeg" />
        <img id="skySnow" src="Resources/Backgrounds/snowy-mountain.jpeg" />
        <img id="skyVillage" src="Resources/Backgrounds/texturify_pano-1-9.jpg"/>
        <img id="skyWhite" src="Resources/Backgrounds/white-building.jpeg" />
        <img id="skyWoods" src="Resources/Backgrounds/woods-by-the-river.jpg" />
      </a-assets>
      <!--ground for player-->
      <a-circle position="0 0 2" rotation="-90 0 0" radius="2" color="grey">
        </a-circle>
      <a-sky id="sky" src="#skyWoods"></a-sky>
      <a-camera id="cameraObj" position="0 1.6 2">
        <a-entity
          cursor="fuse:true;fuseTimeout:500;"
          position="0 0 -1"
          geometry="primitive:ring;radiusInner:0.001;radiusOuter:0.003;"
          material="color:white;shader:flat;"
        ></a-entity>
      </a-camera>
    
      <a-entity id="portalEntity" obj-model="obj: #firstModel;" color="#00FF00"  scale="0.08 0.08 0.08" position="-1.6 0 0.2"
                event-set__scale="_target:#portalEntity; _event:click; animation.to: 0.3 0.3 0.3; animation.easing: easeOutExpo;">
        <a-circle radius="3" rotation="-90 0 0" color="grey"></a-circle>
        </a-entity>
      <a-image id="imageEntity" src="#imgBunyip" position="1.8 1.4 0.5" look-at="#cameraObj"
               event-set__click="_event:click; animation.property:scale;animation.to:3 3 3;animation.easing:linear;"
               event-set__leave="_event:mouseleave;animation.property:scale;animation.to:1 1 1;animation.easing:linear;">
        </a-image>
    <a-image id="imageEntity" src="#imgBunyip2" position="-2.8 1.4 0.5" look-at="#cameraObj"
               event-set__click="_event:click; animation.property:scale;animation.to:3 3 3;animation.easing:linear;"
               event-set__leave="_event:mouseleave;animation.property:scale;animation.to:1 1 1;animation.easing:linear;">
        </a-image>
        <a-text
            id="textPara"
            scale="5 5 5"
            value="HELLO WORLD"
            opacity="0"
            align="center"
            width="6">
            </a-text><!--look-at="#cameraObj"-->
    </a-scene>
  </body>
</html>
