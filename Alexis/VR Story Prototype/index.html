<!DOCTYPE html>
<html>
  <head>
    <title>WanderLust VR Story</title>
    <!-- Load styles -->
    <link href="main.css" rel="stylesheet" />

    <!-- Load A-Frame and additional components -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>
      
    <!-- Load JS Events -->
    <script>
        
        //WrapAround function to loop array variables, and can also change the variable which it is based on. Returns "True" or "False" in case additional functions depend on the wrap status
        function wrapAround(current,min,max){
            var wrapped = false;
            if (current > max) {
                current = min;
                wrapped = true;
            }else if (current < min) {
                current = max;
                wrapped = true;
            }
            return [wrapped,current];
            
        }
        //Navigate between paragraphs
        document.addEventListener("keydown", function (event) {
            //Go to previous paragraph
            if (event.key === "q") {
                scrollingHeight = 0;
                changePage(-1,0);

            //Go to next paragraph
            } else if (event.key === "e") {
                scrollingHeight = 0;
                changePage(1,0);
            }

            if (event.key ==="p"){
                scrollingHeight = 0;
                changePageAll(1);
            }

        });

        var scrollingHeight = 0;
        //Manual scrolling functions
        document.addEventListener("keydown", function (event) {
            //Scroll through paragraphs  
            textObj = document.getElementById("textPara");
            //Scroll up        
            if (event.key === "i"){
                //Remove existing animations
                textObj.removeAttribute("animation__pos");
                textObj.removeAttribute("animation__opa");

                //add to scroll
                scrollingHeight= scrollingHeight+0.2;

                //If greater than or equal to maximum height, reset for next section
                var wrapCheck = wrapAround(scrollingHeight,0,20);
                if (wrapCheck[0]) {
                    scrollingHeight = wrapCheck[1];
                    changePage(1);
                    textObj = document.getElementById("textPara");


                    textObj.setAttribute("opacity", 0);

                    //Reset the Position 
                    textObj.setAttribute("position","0 -10 -20"); 
                }
                
                //Control opacity while scrolling
            if (scrollingHeight>=15){
                textObj.setAttribute("opacity",(20-scrollingHeight)/5);
            }else if (scrollingHeight<=5){
                textObj.setAttribute("opacity",scrollingHeight/5);
            } 
            textObj.object3D.position.y = -10+scrollingHeight;
                
                //Scroll Down
            } else if (event.key === "k") {

                textObj.removeAttribute("animation__pos");
                textObj.removeAttribute("animation__opa");
                
                //subtract from scroll
                scrollingHeight= scrollingHeight-0.2;
                //If less than or equal to min height, reset for previous section      
                var wrapCheck = wrapAround(scrollingHeight,0,20);
                
                if (wrapCheck[0]==true  ) {
                    scrollingHeight = wrapCheck[1];
                    console.log("Loading Previous manual section");
                    changePage(-1);
                    textObj = document.getElementById("textPara");

                    textObj.setAttribute("opacity", 0);

                    //Reset  the Position
                    textObj.setAttribute("position","0 10 -20");   
                }           
                
                //Control opacity while scrolling
            if (scrollingHeight>=15){
                textObj.setAttribute("opacity",(20-scrollingHeight)/5);
            }else if (scrollingHeight<=5){
                textObj.setAttribute("opacity",scrollingHeight/5);
            } 
            textObj.object3D.position.y = -10+scrollingHeight;
            }
            

        });

        //Toggle Background
        var currentSky = 0;
        document.addEventListener("keydown", function (event) {
            //Go to previous paragraph
            if (event.shiftKey) {
                changeSky(1);
            }
        });

        //Handle Click function
        AFRAME.registerComponent("button-click-handler", {
            init: function () {
                var skyEl = this.el.sceneEl.querySelector("#thing");

                this.el.addEventListener("click", function () {
                    skyEl.setAttribute("scale", "5 5 5");
                });
            },
        });

        //Define theBackgrounds
        var currentSky = 0;
        const skies = [];
        skies[1] = "#skyLawn";
        //skies[2] = "#skyScenes";
        //skies[3] = "#skySnow";
        skies[2] = "#skyVillage";
        //skies[5] = "#skyWhite";
        skies[3] = "#skyWoods";
        function changeSky(skyChange) {
            currentSky = wrapAround(currentSky + skyChange,1,skies.length-1)[1];
            var sky = document.getElementById("sky");
            sky.setAttribute("src", skies[currentSky]);
        }

      //Define the page number and change
      var currentPage = 0;
        var tempPage = currentPage;
      function changePage(pageChange, surrounding) {
        currentPage = wrapAround(currentPage+pageChange,1, storyParagraphs.length - 1)[1];
        //Select the text object
        var textObj = document.getElementById("textPara");
          
        textObj.setAttribute("opacity", 0);
        textObj.setAttribute("value", storyParagraphs[currentPage]);

        //Reset and activate the Position animation
        textObj.removeAttribute("animation__pos");
        textObj.setAttribute(
          "animation__pos",
          "property: position; from:0 -10 -20;to: 0 10 -20; dur: 20000; easing: linear; loop: false;"
        );

        //Reset and activate the opacity animation
        textObj.removeAttribute("animation__opa");
        textObj.setAttribute(
          "animation__opa",
          "property: opacity; from:0;to: 1; dur: 10000; easing: linear; loop: 1; dir:alternate;"
        );
        
            
      }
        
        //Define the page number and change for all text objects
        var currentPageAll = 0;
        var tempPage = currentPageAll;
        //Repetitive code for all four text objects, Could be optimized with function but requires too many variables unique to each object - name, location, text value etc
      function changePageAll(pageChange) {
        currentPage=wrapAround(currentPage+1,1, storyParagraphs.length - 1)[1];
        tempPage=currentPage;

        //Select the primary text object
        var textObj = document.getElementById("textPara");
        textObj.setAttribute("value", storyParagraphs[tempPage]);

        //Reset and activate the Position animation
        textObj.removeAttribute("animation__pos");
        textObj.setAttribute(
          "animation__pos",
          "property: position; from:0 -10 -20;to: 0 10 -20; dur: 10000; easing: linear; loop: false;"
        );

        //Reset and activate the opacity animation
        textObj.removeAttribute("animation__opa");
        textObj.setAttribute(
          "animation__opa",
          "property: opacity; from:0;to: 1; dur: 5000; easing: linear;  loop: 1; dir:alternate;"
        );
          
          //Set next temporary page variable 
          tempPage = wrapAround(tempPage+1,1, storyParagraphs.length - 1)[1];
          //Select the Second text object
        var textObj = document.getElementById("textPara2");
          
        textObj.setAttribute("value", storyParagraphs[tempPage]);

        //Reset and activate the Position animation
        textObj.removeAttribute("animation__pos");
        textObj.setAttribute(
          "animation__pos",
          "property: position; from:20 -10 0;to: 20 10 -0; dur: 10000; easing: linear; loop: false;"
        );

        //Reset and activate the opacity animation
        textObj.removeAttribute("animation__opa");
        textObj.setAttribute(
          "animation__opa",
          "property: opacity; from:0;to: 1; dur: 5000; easing: linear;  loop: 1; dir:alternate;"
        );
          
          //Set next temporary page variable 
          tempPage = wrapAround(tempPage+1,1, storyParagraphs.length - 1)[1];
          
          //Select the Third text object
        var textObj = document.getElementById("textPara3");
          
        textObj.setAttribute("value", storyParagraphs[tempPage]);

        //Reset and activate the Position animation
        textObj.removeAttribute("animation__pos");
        textObj.setAttribute(
          "animation__pos",
          "property: position; from:-0 -10 20;to: -0 10 20; dur: 10000; easing: linear; loop: false;"
        );

        //Reset and activate the opacity animation
        textObj.removeAttribute("animation__opa");
        textObj.setAttribute(
          "animation__opa",
          "property: opacity; from:0;to: 1; dur: 5000; easing: linear; loop: 1; dir:alternate;"
        );
          
          //Set next temporary page variable 
          tempPage = wrapAround(tempPage+1,1, storyParagraphs.length - 1)[1];
          
          //Select the Fourth text object
        var textObj = document.getElementById("textPara4");

        textObj.setAttribute("value", storyParagraphs[tempPage]);

        //Reset and activate the Position animation
        textObj.removeAttribute("animation__pos");
        textObj.setAttribute(
          "animation__pos",
          "property: position; from:-20 -10 -0;to: -20 10 -0; dur: 10000; easing: linear; loop: false;"
        );

        //Reset and activate the opacity animation
        textObj.removeAttribute("animation__opa");
        textObj.setAttribute(
          "animation__opa",
          "property: opacity; from:0;to: 1; dur: 5000; easing: linear; loop: 1; dir:alternate;"
        );
      }

      //Define Story paragraphs
      const storyParagraphs = [];
        {
      storyParagraphs[0] = "THIS IS THE ZEROTH PARAGRAPH, NO ONE WILL SEE THIS";
      storyParagraphs[1] =
        "1 Fable: Long ago in the Blue Mountains, three Aboriginal sisters; Meenhi, Wimlah and Gunnedoo lived with their father, a Witch doctor named Tyawan. In the same forest lived a gigantic creature that was feared by all – he was the Bunyip. Tyawan who knew where he lived would leave his daughters on the cliff behind a rocky wall where they would be safe while he would collect food.";
      storyParagraphs[2] =
        "2 One day, waving goodbye to his daughters he descended the cliff steps. On the top of the cliff, a big lizard suddenly appeared and frightened Meenhi. She picked up a stone and threw it at the lizard. The stone rolled away over the cliff and crashed into the valley below. Suddenly, the rocks behind the three sisters split open, leaving the sisters on a thin ledge. There was a deep rumble from below and the angry Bunyip emerged from his sleep. He looked up to see who had rudely awakened him and there perched on the thin ledge he saw the sisters cowering in fear. Furiously he lurched towards them.";
      storyParagraphs[3] =
        "3 In the valley, Tyawan heard the cry and looked up to see that the Bunyip had almost reached his daughters. Frantically the Witch Doctor pointed his magic bone at the girls and turned them into stone. They would be safe there until the Bunyip was gone and then Tyawan would return them to their former selves.";
      storyParagraphs[4] =
        "4 The Bunyip was even more angry when he saw what had happened and he turned on Tyawan and began to chase him. Running away, Tyawan found himself trapped against a rock which he could neither climb nor go around. He quickly changed into a Lyrebird and disappeared into a small cave. Everyone was safe but Tyawan had dropped his magic bone. The Bunyip returned angrily to his hole. Tyawan crept out of the cave and searched for the bone, and is still seeking it while the Three Sisters stand silently waiting, hoping he will find the bone and turn them back to their former selves. \n \n You can see the Three Sisters today from Echo Point and in the valley you can hear Tyawan, the Lyrebird, calling them as he searches for his lost magic bone.";
      storyParagraphs[5] =
        "5 Moral: The forests are beautiful, but you must always be careful to know what creatures live there.";
        }
    </script>
  </head>
    
  <body>
    <!-- HTML Elements to create a page before scene
    <button type="button" onClick="onClick()">Click me</button>
    <p>Clicks: <a id="clicks">0</a></p>
    -->
    <a-scene id="VRScene">
        
    <!-- ###################  LOAD ASSETS INTO STORY  #################### -->
      <a-assets>
        
        <a-asset-item id="firstModel" src="Resources/Objects/testObj.obj"></a-asset-item>
        <!-- CANNOT UPLOAD LARGE OBJECTS TO GITHUB -->
        <!--<a-asset-item id="venator" src="Resources/Objects/venator/Venator.obj"></a-asset-item>
        <a-asset-item id="plant1" src="Resources/Objects/folder/Vase%20Pack%202.FBX"></a-asset-item>-->
        <img id="imgBunyip" src="Resources/Images/Bunyip_5.jpg"/>
        <img id="imgBunyip2" src="Resources/Images/bunyip-emerging.jpg"/>
          
        <!-- Skybox Images-->
        <img id="skyLawn" src="Resources/Backgrounds/lawn-Mansion.jpeg" />
        <img id="skyScenes" src="Resources/Backgrounds/scenes.jpeg" />
        <img id="skySnow" src="Resources/Backgrounds/snowy-mountain.jpeg" />
        <img id="skyVillage" src="Resources/Backgrounds/texturify_pano-1-9.jpg"/>
        <img id="skyWhite" src="Resources/Backgrounds/white-building.jpeg" />
        <img id="skyWoods" src="Resources/Backgrounds/woods-by-the-river.jpg" />
      </a-assets>
        
      <!--ground for player-->
      <a-circle position="0 0 2" rotation="-90 0 0" radius="2" color="grey"></a-circle>
        
      <a-sky id="sky" src="#skyWoods"></a-sky>
        
        <!-- ###################  CAMERA/PLAYER ENTITIES  #################### -->
      <a-entity camera look-controls id="cameraObj" position="0 1.6 2" wasd-controls="enabled:true;acceleration:10;">
        <a-entity
          cursor="fuse:true;fuseTimeout:500;"
          position="0 0 -1"
          geometry="primitive:ring;radiusInner:0.001;radiusOuter:0.003;"
          material="color:white;shader:flat;"></a-entity>
      </a-entity>
    
        <!-- ###################  STORY ENTITIES  #################### -->
        <a-entity id="modelEntity" obj-model="obj: #firstModel;" color="#00FF00" scale="0.06 0.06 0.06" position="-1.6 0 0.2"
            event-set__click="_event:click; animation.property:scale;animation.to:0.2 0.2 0.2;animation.easing:linear;"
            event-set__leave="_event:mouseleave;animation.property:scale;animation.to:0.06 0.06 0.06;animation.easing:linear;">>
            <a-circle radius="3" rotation="-90 0 0" color="grey"></a-circle>
        </a-entity>
        <a-image id="imageEntity" src="#imgBunyip" position="2.6 1.4 -0.8" opacity="0" look-at="#cameraObj"
            animation__fadeIn="property:opacity;to:1 1 1;easing:linear; duration:5000;"
            event-set__click="_event:click; animation.property:scale;animation.to:3 3 3;animation.easing:linear;"
            event-set__leave="_event:mouseleave;animation.property:scale;animation.to:1 1 1;animation.easing:linear;">
            </a-image>
        <a-image id="imageEntity" src="#imgBunyip2" position="-2.6 1.4 -0.8" opacity="0" look-at="#cameraObj"
            animation__fadeIn="property:opacity;to:1 1 1;easing:linear; duration:5000;"
            event-set__click="_event:click; animation.property:scale;animation.to:3 3 3;animation.easing:linear;"
            event-set__leave="_event:mouseleave;animation.property:scale;animation.to:1 1 1;animation.easing:linear;">
            </a-image>
        
        
        <!-- ###################  TEXT ENTITIES  #################### -->
        <a-text
            id="textPara"
            scale="5 5 5"
            value="HELLO WORLD"
            opacity="0"
            align="center"
            color="#FFFFFF"
            width="6"look-at="#cameraObj">
            </a-text>
        <a-text
            id="textPara2"
            scale="5 5 5"
            value="HELLO WORLD"
            opacity="0"
            align="center"
            color="#FFFFFF"
            width="6"look-at="#cameraObj">
            </a-text>
        <a-text
            id="textPara3"
            scale="5 5 5"
            value="HELLO WORLD"
            opacity="0"
            align="center"
            color="#FFFFFF"
            width="6"look-at="#cameraObj">
            </a-text>
        <a-text
            id="textPara4"
            scale="5 5 5"
            value="HELLO WORLD"
            opacity="0"
            align="center"
            color="#FFFFFF"
            width="6"look-at="#cameraObj">
            </a-text>
    </a-scene>
  </body>
</html>
