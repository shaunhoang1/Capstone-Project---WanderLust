<!doctype html>
<html>
    <head>
        <title>WanderLust VR Story</title>
        
        
        <!-- Load styles -->
        <link href="main.css" rel="stylesheet">
        
        
        <!-- Load A-Frame -->
        <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
        
        
        <!-- Function to Load Scene -->
        <script>
            function createScene(){
                //Load the SCene
                var scene = document.createElement("a-scene");
                scene.setAttribute("id","VRScene");                
                var element = document.getElementById("new");
                element.appendChild(scene);
                
                //Create box and sky elements
                var box = document.createElement("a-box");
                var skyBox=document.createElement("a-sky");
                skyBox.setAttribute('src',"screenshots/woods-by-the-river.jpg");
                scene.appendChild(box);
                scene.appendChild(skyBox);
                
                //Create rotating Box
                var rotatingBox = document.createElement("a-box");
                rotatingBox.setAttribute('position',"-1 6 -2");
                rotatingBox.setAttribute('animation__POSITIONX',"property: position; from:-4 8 -10;to: 4 8 -10; dur: 2000; easing: linear; loop: false; dir:alternate" );
                rotatingBox.setAttribute('animation__OPACITY','property: opacity; from:0;to: 1; dur: 1000; easing: linear; loop: 1; dir:alternate');
                rotatingBox.setAttribute('color','#00FF00');
                rotatingBox.setAttribute('text-next-click-handler','');
                scene.appendChild(rotatingBox);
                                  
                //initialize camera object
                var camObj = document.createElement("a-camera");
                camObj.setAttribute('position','0 1.6 2');
                scene.appendChild(camObj);
                var cursorObj = document.createElement("a-entity");
                cursorObj.setAttribute('cursor','fuse: true; fuseTimeout: 500');
                cursorObj.setAttribute('position','0 0 -1');
                cursorObj.setAttribute('geometry','primitive: ring; radiusInner: 0.02; radiusOuter: 0.03');
                cursorObj.setAttribute('material','color: black; shader: flat');
                camObj.appendChild(cursorObj);
                
                //Create text 
                var textObj = document.createElement("a-text");
                textObj.setAttribute('id','textPara');
                textObj.setAttribute('value','The city of Porto is full of sky-high lookouts and rooftop bars that afford expansive views. Yet the most memorable and unique experiences are often at ground level.!')
                textObj.setAttribute('scale','5 5 5')
                textObj.setAttribute('animation','property: position; from:-8 -20 -10;to: -8 10 -10; dur: 10000; easing: linear; loop: false;')
                textObj.setAttribute('animation__2','property: opacity; from:0;to: 1; dur: 5000; easing: linear; loop: 1; dir:alternate;')
                scene.appendChild(textObj)
            }
        </script>
        
        
        <!-- Load JS Events -->
        <script>
            //hide the scene
            document.addEventListener('keydown', function (event) {
                if (event.altKey && event.key === "q") {
                    //document.getElementById("VRScene").style.zIndex = "-1";
                }
            });
            
            //interactions
            AFRAME.registerComponent('button-interaction-handler', {
                init: function () {
                    var skyEl = this.el.sceneEl.querySelector('#background');
                    var cubeEl = this.el.sceneEl.querySelector('#left-cube');

                    this.el.addEventListener('mouseenter', function () {
                        skyEl.setAttribute('src', '#pano-brush');  
                        cubeEl.setAttribute('scale', '3 3 3');  
                        document.querySelector('[camera]').setAttribute('wasd-controls-enabled','"false"');
                    });

                    this.el.addEventListener('mouseleave', function () {
                        skyEl.setAttribute('src', '#pano-town');
                        cubeEl.setAttribute('scale', '1 1 1');
                        document.querySelector('[camera]').setAttribute('wasd-controls-enabled','"true"');
                    });
                }  
            });

            AFRAME.registerComponent('text-next-click-handler', {
                init: function () {
                    //var skyEl = this.el.sceneEl.querySelector('#thing');
                    var textObj = document.getElementById("textPara")
                    this.el.addEventListener('click', function () {
                        textObj.removeAttribute('animation');
                        textObj.removeAttribute('animation__2');
                        textObj.setAttribute('animation','property: position; from:-8 -20 -10;to: -8 10 -10; dur: 10000; easing: linear; loop: false;')
                        textObj.setAttribute('animation__2','property: opacity; from:0;to: 1; dur: 5000; easing: linear; loop: 1; dir:alternate;')
                    });
                }   
            });
            
            AFRAME.registerComponent('button-click-handler', {
                init: function () {
                    var skyEl = this.el.sceneEl.querySelector('#thing');

                    this.el.addEventListener('click', function () {
                        skyEl.setAttribute('scale', '5 5 5');  
                    });
                }   
            });

            function ChangeDepth(){
                document.getElementById("VRScene").style.zIndex="auto";
            }
        </script>
        
    </head>
    <body>
        <div style="z-index:auto;">
            <p>
                Hello World!
            </p>
            <div class='support'>
              <button class='show-large' onclick="createScene()">ENTER VR HERE</button>
            </div>
            <p id="new">
            Here is a big description as the first paragraph within the story
            </p>
        </div>
        
        
    </body>
</html>